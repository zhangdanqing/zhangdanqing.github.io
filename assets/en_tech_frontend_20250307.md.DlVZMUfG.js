import{_ as i,a,b as t,c as n,d as e,e as l,f as h,g as p,h as k,i as r,j as o,k as E,l as d,m as g,n as c,o as y,p as u,q as F,r as m,s as C,t as b,u as A,v as x,w as _}from"./chunks/google-login.BVj5-DkY.js";import{_ as f,c as D,o as v,ae as B}from"./chunks/framework.BjlC_BXf.js";const L=JSON.parse('{"title":"Next.js Full-Stack Practice: Step-by-Step Integration of NextAuth for Google/GitHub One-Click Login","description":"","frontmatter":{},"headers":[],"relativePath":"en/tech/frontend/20250307.md","filePath":"en/tech/frontend/20250307.md"}'),I={name:"en/tech/frontend/20250307.md"};function q(G,s,w,S,T,P){return v(),D("div",null,s[0]||(s[0]=[B('<h1 id="next-js-full-stack-practice-step-by-step-integration-of-nextauth-for-google-github-one-click-login" tabindex="-1">Next.js Full-Stack Practice: Step-by-Step Integration of NextAuth for Google/GitHub One-Click Login <a class="header-anchor" href="#next-js-full-stack-practice-step-by-step-integration-of-nextauth-for-google-github-one-click-login" aria-label="Permalink to &quot;Next.js Full-Stack Practice: Step-by-Step Integration of NextAuth for Google/GitHub One-Click Login&quot;">‚Äã</a></h1><img src="'+i+`" alt="alt text" style="width:100%;height:auto;"><h2 id="üî•-introduction" tabindex="-1">üî• Introduction <a class="header-anchor" href="#üî•-introduction" aria-label="Permalink to &quot;üî• Introduction&quot;">‚Äã</a></h2><p>Recently, I wanted to build a full-stack application, and I hoped to implement the login feature through Google authorization. I found that Next.js is quite suitable as it integrates NextAuth, allowing for easy implementation of various authentication and authorization features without manually handling tokens and sessions. It supports login via popular platforms like Google and GitHub. I attempted to set it up and would like to share the setup process and challenges encountered.</p><h2 id="üõ†Ô∏è-environment-setup" tabindex="-1">üõ†Ô∏è Environment Setup <a class="header-anchor" href="#üõ†Ô∏è-environment-setup" aria-label="Permalink to &quot;üõ†Ô∏è Environment Setup&quot;">‚Äã</a></h2><p>Ensure the project is initialized with Next.js and dependencies are installed:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create-next-app@latest</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> next-app</span></span></code></pre></div><p>If you wish to develop the project using TypeScript, you can create a TypeScript project with the <code>--typescript</code> parameter:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create-next-app@latest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --typescript</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> next-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --typescript</span></span></code></pre></div><p>Once created, run <code>pnpm run dev</code> or <code>yarn dev</code> to start the development server. Visit <a href="http://localhost:3000" target="_blank" rel="noreferrer">http://localhost:3000</a> to see the project running successfully, and develop the project content as needed.</p><h2 id="üåê-configuring-nextauth-core-files" tabindex="-1">üåê Configuring NextAuth Core Files <a class="header-anchor" href="#üåê-configuring-nextauth-core-files" aria-label="Permalink to &quot;üåê Configuring NextAuth Core Files&quot;">‚Äã</a></h2><ol><li><p><strong>Create API Route</strong></p><p>Create a <code>route.ts</code> file under <code>src/app/api/auth/[...nextauth]</code> directory.</p></li></ol><img src="`+a+'" alt="alt text" style="width:100%;height:auto;"><ol start="2"><li><p><strong>Install Dependencies</strong></p><p>Run the following command in the root directory of the project to install the necessary dependencies:</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> next-auth</span></span></code></pre></div><ol start="3"><li><p><strong>Enhance Project Content and Sign In Button</strong></p><p>Develop specific content and build pages in the project. Below is my project, which has implemented the UI functionality. I need to add a click event to the Sign In button, which redirects to third-party Google/GitHub authorization login when clicked.</p></li></ol><img src="'+t+`" alt="alt text" style="width:100%;height:auto;text-align:center;"><ol start="4"><li><p><strong>Redirect Sign In Button to Third Party</strong></p><p>Click the Sign In button to execute <code>handleGoogleLogin</code>, redirecting to Google or GitHub.</p></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> signIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;google&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  callbackUrl: callbackUrl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><img src="`+n+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ol start="5"><li><p><strong>Implement Authentication Code</strong></p><p>Implement the authentication logic in the <code>api/auth/[...nextauth]/route.ts</code> file.</p></li></ol><img src="'+e+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><h2 id="üîë-applying-for-google-oauth-permissions" tabindex="-1">üîë Applying for Google OAuth Permissions <a class="header-anchor" href="#üîë-applying-for-google-oauth-permissions" aria-label="Permalink to &quot;üîë Applying for Google OAuth Permissions&quot;">‚Äã</a></h2><ul><li><p><strong>Step 1: Google Cloud Console</strong></p><p>Go to <a href="https://console.cloud.google.com/" target="_blank" rel="noreferrer">Google Cloud</a></p><p>See the current project, click the name circled in red to create a project, and select no organization.</p></li></ul><img src="'+l+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><img src="'+h+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ul><li><p><strong>Step 2: Configuration</strong></p><p>Click &quot;API &amp; Services&quot; on the left menu, then click &quot;OAuth consent screen.&quot;</p></li></ul><img src="'+p+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><p>Follow the prompts to fill in the steps, selecting the audience as external.</p><img src="'+k+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><img src="'+r+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ul><li><strong>Step 3: Client Configuration</strong></li></ul><img src="'+o+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><img src="'+E+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><p>Authorized JavaScript origins: <code>http://localhost:3000</code></p><p>Authorized redirect URIs:</p><p><code>http://localhost:3000/api/auth/callback/google</code></p><p><code>https://your-domain-after-launch.com/api/auth/callback/google</code></p><img src="'+d+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ul><li><p><strong>Step 4:</strong></p><p>After creation, a client ID and client secret will be generated. Save them, as they will be used later in environment variables for authorization.</p></li></ul><img src="'+g+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><img src="'+c+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ul><li><p><strong>Step 5:</strong></p><p>Add a test user by adding your Google account as a test user.</p></li></ul><img src="'+y+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><h2 id="üîë-applying-for-github-oauth-permissions" tabindex="-1">üîë Applying for GitHub OAuth Permissions <a class="header-anchor" href="#üîë-applying-for-github-oauth-permissions" aria-label="Permalink to &quot;üîë Applying for GitHub OAuth Permissions&quot;">‚Äã</a></h2><ul><li><p><strong>Step 1:</strong></p><p>Go to GitHub, click your profile picture, and select settings.</p></li></ul><img src="'+u+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ul><li><p><strong>Step 2:</strong></p><p>Select &quot;Developer settings&quot; at the bottom left.</p></li></ul><img src="'+F+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ul><li><p><strong>Step 3:</strong></p><p>Select &quot;OAuth Apps.&quot;</p></li></ul><img src="'+m+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><ul><li><p><strong>Step 4:</strong></p><p>Fill in the steps as prompted.</p></li></ul><img src="'+C+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><p>Homepage URL: <code>http://localhost:3000</code></p><p>Authorization callback URL: <code>http://localhost:3000/api/auth/callback/github</code></p><img src="'+b+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><p>Click &quot;Generate a new client secret&quot; to generate the secret, and save the client ID and secret for later use in environment variables.</p><img src="'+A+`" alt="alt text" style="width:100%;height:auto;text-align:center;"><h2 id="üìù-configuring-environment-variables" tabindex="-1">üìù Configuring Environment Variables <a class="header-anchor" href="#üìù-configuring-environment-variables" aria-label="Permalink to &quot;üìù Configuring Environment Variables&quot;">‚Äã</a></h2><p>Create a <code>.env</code> file in the root directory and fill in the client ID and secret obtained earlier for Google and GitHub.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NextAuth core configuration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXTAUTH_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:3000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Base URL used for OAuth callbacks</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXTAUTH_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_secure_secret_here</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Randomly generated secret used for encrypting session tokens and CSRF tokens</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Google OAuth</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GOOGLE_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_google_client_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GOOGLE_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_google_secret</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GitHub OAuth</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GITHUB_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_github_client_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GITHUB_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_github_secret</span></span></code></pre></div><h2 id="üíª-frontend-integration" tabindex="-1">üíª Frontend Integration <a class="header-anchor" href="#üíª-frontend-integration" aria-label="Permalink to &quot;üíª Frontend Integration&quot;">‚Äã</a></h2><p>In the <code>api/auth/[...nextauth]/route.ts</code> file, implement the authentication logic using the client ID and secret.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextAuth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GoogleProvider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth/providers/google&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GithubProvider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;next-auth/providers/github&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextAuth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  providers: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    GithubProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      clientId: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GITHUB_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      clientSecret: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GITHUB_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    GoogleProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      clientId: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      clientSecret: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  secret: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NEXTAUTH_SECRET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  debug: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Enable debug mode to view detailed error information</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pages: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    signIn: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/auth/signin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    error: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/auth/error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  callbacks: {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session.user) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Extend session.user type to include id property</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        (session.user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session.user,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          id: token.sub</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jwt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">account</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (account </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;OAuth account information:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          provider: account.provider,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          type: account.type,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          access_token: account.access_token?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          id: user.id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        token.accessToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> account.access_token;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        token.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.id;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> token;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">baseUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Default behavior: Allow NextAuth to handle OAuth redirects</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (url.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">baseUrl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url).origin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> baseUrl) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> baseUrl;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> signIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">account</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">profile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;OAuth request target URL:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, account?.authorization_url);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { handler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GET, handler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POST };</span></span></code></pre></div><h2 id="üöÄ-demo" tabindex="-1">üöÄ Demo <a class="header-anchor" href="#üöÄ-demo" aria-label="Permalink to &quot;üöÄ Demo&quot;">‚Äã</a></h2><p>GitHub authorization login</p><img src="`+x+'" alt="alt text" style="width:100%;height:auto;text-align:center;"><p>Google authorization login</p><img src="'+_+`" alt="alt text" style="width:100%;height:auto;text-align:center;"><h2 id="‚ö†Ô∏è-common-issues" tabindex="-1">‚ö†Ô∏è Common Issues <a class="header-anchor" href="#‚ö†Ô∏è-common-issues" aria-label="Permalink to &quot;‚ö†Ô∏è Common Issues&quot;">‚Äã</a></h2><h3 id="_1-google-link-reports-etimedout-93-46-8-90-443-or-timeout-issues-in-chrome" tabindex="-1">1. Google link reports ETIMEDOUT 93.46.8.90:443 or timeout issues in Chrome <a class="header-anchor" href="#_1-google-link-reports-etimedout-93-46-8-90-443-or-timeout-issues-in-chrome" aria-label="Permalink to &quot;1. Google link reports ETIMEDOUT 93.46.8.90:443 or timeout issues in Chrome&quot;">‚Äã</a></h3><p>I tried using a proxy in <code>api/auth/[...nextauth]/route.ts</code>, but it didn&#39;t work.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { HttpsProxyAgent } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https-proxy-agent&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { HttpProxyAgent } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;http-proxy-agent&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> proxyUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTTPS_PROXY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;http://127.0.0.1:7890&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Replace with your proxy address</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> httpAgent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpProxyAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(proxyUrl);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> httpsAgent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpsProxyAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(proxyUrl);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GoogleProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  clientId: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  clientSecret: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  authorization: { params: { access_type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  httpOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: httpsAgent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>I also tried using <code>fetch</code>, as some proxy environments are more friendly to <code>node-fetch</code>. I attempted to force NextAuth to use <code>fetch</code>, but it still didn&#39;t work.</p><p>The issue was eventually resolved by using a global proxy, especially by enabling TUN mode. Most connection issues are likely due to proxy problems.</p><h3 id="_2-google-timeout-issues-can-be-resolved-by-increasing-the-timeout" tabindex="-1">2. Google timeout issues can be resolved by increasing the timeout <a class="header-anchor" href="#_2-google-timeout-issues-can-be-resolved-by-increasing-the-timeout" aria-label="Permalink to &quot;2. Google timeout issues can be resolved by increasing the timeout&quot;">‚Äã</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GoogleProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  clientId: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  clientSecret: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  httpOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    timeout: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Increase the timeout to 10 seconds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,77)]))}const U=f(I,[["render",q]]);export{L as __pageData,U as default};
